<!-- Trains List Section -->
<div class="px-4">
  <p-card header="ðŸš† Trains List" class="rounded-xl shadow-lg">
    <!-- Add Button -->
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-lg font-semibold">Manage All Trains</h2>
      <custom-button
        type="danger"
        buttonText="Add Train"
        icon="pi pi-plus"
        size="small"
        [routerLink]="['/admin/add-train']"
      ></custom-button>
    </div>

    <!-- Table -->
    <div class="w-full overflow-x-auto">
      <p-table
        [value]="trains"
        [size]="'small'"
        class="p-datatable-striped p-datatable-sm"
      >
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="number">
              <div class="flex items-center gap-2">
                <i class="pi pi-tag text-blue-500"></i> Number
                <p-sortIcon field="number" />
              </div>
            </th>
            <th pSortableColumn="name">
              <div class="flex items-center gap-2">
                <i class="pi pi-book text-green-500"></i> Name
                <p-sortIcon field="name" />
              </div>
            </th>
            <th>
              <div class="flex items-center gap-2">
                <i class="pi pi-arrow-circle-right text-gray-600"></i> Source
              </div>
            </th>
            <th>
              <div class="flex items-center gap-2">
                <i class="pi pi-arrow-circle-left text-gray-600"></i>
                Destination
              </div>
            </th>
            <th pSortableColumn="totalDistance">
              <div class="flex items-center gap-2">
                <i class="pi pi-compass text-orange-500"></i> Distance (Km)
                <p-sortIcon field="totalDistance" />
              </div>
            </th>
            <th class="text-center">
              <i class="pi pi-cog text-gray-500"></i> Actions
            </th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-train>
          <tr>
            <td>{{ train.number }}</td>
            <td>{{ train.name }}</td>
            <td>{{ train.sourceStation.name }}</td>
            <td>{{ train.destinationStation.name }}</td>
            <td>{{ train.totalDistance }} Km</td>
            <td>
              <div class="flex justify-center gap-2">
                <p-button
                  pTooltip="Update Train"
                  icon="pi pi-pencil"
                  tooltipPosition="top"
                  severity="info"
                  size="small"
                  rounded
                  tooltip="Edit"
                  (click)="showUpdateModalClicked(train)"
                />
                <p-button
                  pTooltip="Delete Train"
                  tooltipPosition="top"
                  (click)="handleDeleteTrain(train)"
                  icon="pi pi-trash"
                  severity="danger"
                  size="small"
                  rounded
                  tooltip="Delete"
                />
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="footer">
          <tr>
            <td
              colspan="6"
              class="text-right font-medium text-sm text-gray-600"
            >
              Total Trains: {{ trains.length || 0 }}
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </p-card>
</div>

<!-- Edit Train Modal -->
<custom-dialog
  *ngIf="trainToUpdate"
  [visible]="showUpdateModal"
  (visibleChange)="showUpdateModal = $event"
  [header]="'Update Train: ' + trainToUpdate.name"
>
  <form action="" *ngIf="trainToUpdate">
    <!-- train name field -->
    <div>
      <label for="trainName" class="block text-sm font-medium text-gray-700">
        Train Name
      </label>
      <input
        id="trainName"
        type="text"
        class="w-full mt-2"
        [(ngModel)]="trainToUpdate.name"
        name="trainName"
        pInputText
        required
      />
    </div>

    <!-- train number field -->
    <div class="mt-3">
      <label for="trainNumber" class="block text-sm font-medium text-gray-700">
        Train Number
      </label>
      <input
        id="trainNumber"
        type="text"
        class="w-full mt-2"
        [(ngModel)]="trainToUpdate.number"
        name="trainNumber"
        pInputText
        required
      />
    </div>

    <div class="mt-3 flex justify-end">
      <p-button
        label="Update Train"
        class="mt-4"
        type="success"
        icon="pi pi-check"
      ></p-button>

      <p-button
        label="Close"
        class="mt-4 ml-2"
        severity="danger"
        icon="pi pi-arrow-circle-left"
        (click)="showUpdateModal = false"
      ></p-button>
    </div>
  </form>
</custom-dialog>
